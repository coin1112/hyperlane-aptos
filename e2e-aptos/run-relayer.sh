#!/bin/bash
set -e


export HYP_RUST_BACKTRACE="full"
export HYP_LOG_FORMAT="compact"
export HYP_LOG_LEVEL="trace"
export HYP_INTERVAL="5"
#export HYP_LOG_LEVEL="0"

export HYP_RELAYCHAINS="aptoslocalnet1,aptoslocalnet2"
export HYP_CHAINS_TEST1_NAME="aptoslocalnet1"
export HYP_CHAINS_TEST2_NAME="aptoslocalnet2"
export HYP_CHAINS_TEST1_CHAINID="14411"
export HYP_CHAINS_TEST2_CHAINID="14412"
export HYP_CHAINS_TEST1_PROTOCOL="aptos"
export HYP_CHAINS_TEST2_PROTOCOL="aptos"
export HYP_CHAINS_TEST1_RPCURLS="http://127.0.0.1:8545,http://127.0.0.1:8545"
export HYP_CHAINS_TEST2_RPCURLS="http://127.0.0.1:8545,http://127.0.0.1:8545"
export HYP_CHAINS_TEST1_MAILBOX="0x476307c25c54b76b331a4e3422ae293ada422f5455efed1553cf4de1222a108f"
export HYP_CHAINS_TEST2_MAILBOX="0xd338e68ca12527e77cab474ee8ec91ffa4e6512ced9ae8f47e28c5c7c4804b78"
export HYP_CHAINS_TEST1_INTERCHAINGASPAYMASTER="0xc5cb1f1ce6951226e9c46ce8d42eda1ac9774a0fef91e2910939119ef0c95568"
export HYP_CHAINS_TEST2_INTERCHAINGASPAYMASTER="0xea7d568d0705450331a8f09fd1c823faec91f4ef1c7e6ed4b12c0c53d0c08bc8"
export HYP_CHAINS_TEST1_VALIDATORANNOUNCE="0xa4a4eb4bab83650ba62cabe9ce429ad021b29c12f2fbf808768838255c7e191d"
export HYP_CHAINS_TEST2_VALIDATORANNOUNCE="0xce1f65297828eaa6e460724a869317154f05cdde26619c0e5c0ca23aac3f69c7"
export HYP_CHAINS_APTOSLOCALNET1_MERKLETREEHOOK="0x476307c25c54b76b331a4e3422ae293ada422f5455efed1553cf4de1222a108f"
export HYP_CHAINS_APTOSLOCALNET2_MERKLETREEHOOK="0xd338e68ca12527e77cab474ee8ec91ffa4e6512ced9ae8f47e28c5c7c4804b78"
export HYP_CHAINS_TEST1_MERKLETREEHOOK="0x476307c25c54b76b331a4e3422ae293ada422f5455efed1553cf4de1222a108f"
export HYP_CHAINS_TEST2_MERKLETREEHOOK="0xd338e68ca12527e77cab474ee8ec91ffa4e6512ced9ae8f47e28c5c7c4804b78"
export HYP_CHECKPOINTSYNCER_TYPE="localStorage"
export HYP_ALLOWLOCALCHECKPOINTSYNCERS=true
export HYP_CHAINS_APTOSLOCALNET1_CONNECTION_URLS="http://127.0.0.1:8080/v1"
export HYP_CHAINS_APTOSLOCALNET2_CONNECTION_URLS="http://127.0.0.1:8080/v1"
export HYP_CHAINS_APTOSLOCALNET1_RPCCONSENSUSTYPE="httpFallback"
export HYP_CHAINS_APTOSLOCALNET2_RPCCONSENSUSTYPE="httpFallback"
export HYP_CHAINS_APTOSLOCALNET1_SIGNER_KEY="0x8cb68128b8749613f8df7612e4efd281f8d70f6d195c53a14c27fc75980446c1"
export HYP_CHAINS_APTOSLOCALNET2_SIGNER_KEY="0xf984db645790f569c23821273a95ee3878949e1098c29bcb0ba14101309adeae"

if [ $# -eq 0 ]; then
  echo "Error: No arguments were passed. allowed 0 or 1"
  exit 1
fi


#validator
if [[ $1 -eq 0 ]]; then
  echo "Setting up relaey 0"
  export HYP_METRICSPORT="9096"
  export HYP_DB="/tmp/hp/relayer0"
  export HYP_ORIGINCHAINNAME="aptoslocalnet1"
  export HYP_VALIDATOR_KEY="0xb25d6937002ecd4d79c7bdfddc0053febc8896f2109e96c45bf69efd84544cd5"
  export HYP_CHECKPOINTSYNCER_PATH="/tmp/hp/checkpoints0"

elif [[ $1 -eq 1 ]]; then
  echo "Setting up relayer 1"

  export HYP_METRICSPORT="9097"
  export HYP_DB="/tmp/hp/relayer1"
  export HYP_ORIGINCHAINNAME="aptoslocalnet2"
  export HYP_VALIDATOR_KEY="0xe299c1e6e1f89b4ed2992782137e24d5edbfc51bb702635a85ed6b687c2b5988"
  export HYP_CHECKPOINTSYNCER_PATH="/tmp/hp/checkpoints1"

else
  echo "Error: Argument must be 0 or 1."
  exit 1
fi

rm -rf "$HYP_DB" || true
mkdir -p "$HYP_DB"

pushd ../rust
target/debug/relayer


